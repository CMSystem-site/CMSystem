<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.lightina.managebooks.dao.ForumMapper">

    <!--创建Topic-->
    <insert id="addTopic" parameterType="Topic">
        insert into topic(userID,date,tag,commentCount,title,abstracts,text,courseID)
        values(#{topic.userID},#{topic.date},#{topic.tag},#{topic.commentCount},#{topic.title},#{topic.abstracts},#{topic.text},#{topic.courseID})
    </insert>

    <!--查询Topic-->
    <select id="getTopicByCourseID" resultType="Topic">
        select topic.* from topic
        where topic.courseID = #{courseID}
    </select>

    <!--查询单个讨论主题的内容-->
    <select id="getTopicByTopicID" resultType="Topic">
        select topic.* from topic
        where topic.topicID = #{topicID}
    </select>

    <!--在某个主题下面添加评论-->
    <insert id="addComment" parameterType="Comment">
        insert into comment(userID,topicID,date,text,reCommentCount,email,website)
        values (#{comment.userID},#{comment.topicID},#{comment.date},#{comment.text},#{comment.reCommentCount},#{comment.email},#{comment.website})
    </insert>

    <!--查询某个主题下面的所有评论-->
    <select id="getComment_allByTopicID" resultType="Comment">
        select comment.*
        from comment,topic
        where topic.topicID = comment.topicID
    </select>

    <!--在某个评论下添加回复-->
    <insert id="addReComment" parameterType="ReComment">
        insert into topic(text) values(#{topic.text})
        insert into recomment(commentID,userID,text,date,email,website)
        values (#{recomment.commentID},#{recomment.userID},#{recomment.text},#{recomment.date},#{recomment.email},#{recomment.website})
    </insert>


    <!--获取某个评论下的所有回复-->
    <select id="getReComment_allByCommentID" resultType="ReComment">
        select recomment.*
        from recomment,comment
        where recomment.commentID = comment.commentID
    </select>

</mapper>